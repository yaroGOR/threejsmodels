{"ast":null,"code":"import { MathUtils } from 'three';\n\nfunction Node(type) {\n  this.uuid = MathUtils.generateUUID();\n  this.name = '';\n  this.type = type;\n  this.userData = {};\n}\n\nNode.prototype = {\n  constructor: Node,\n  isNode: true,\n  hashProperties: undefined,\n  analyze: function analyze(builder, settings) {\n    settings = settings || {};\n    builder.analyzing = true;\n    this.build(builder.addFlow(settings.slot, settings.cache, settings.context), 'v4');\n    builder.clearVertexNodeCode();\n    builder.clearFragmentNodeCode();\n    builder.removeFlow();\n    builder.analyzing = false;\n  },\n  analyzeAndFlow: function analyzeAndFlow(builder, output, settings) {\n    settings = settings || {};\n    this.analyze(builder, settings);\n    return this.flow(builder, output, settings);\n  },\n  flow: function flow(builder, output, settings) {\n    settings = settings || {};\n    builder.addFlow(settings.slot, settings.cache, settings.context);\n    var flow = {};\n    flow.result = this.build(builder, output);\n    flow.code = builder.clearNodeCode();\n    flow.extra = builder.context.extra;\n    builder.removeFlow();\n    return flow;\n  },\n  build: function build(builder, output, uuid) {\n    output = output || this.getType(builder, output);\n    var data = builder.getNodeData(uuid || this);\n\n    if (builder.analyzing) {\n      this.appendDepsNode(builder, data, output);\n    }\n\n    if (builder.nodes.indexOf(this) === -1) {\n      builder.nodes.push(this);\n    }\n\n    if (this.updateFrame !== undefined && builder.updaters.indexOf(this) === -1) {\n      builder.updaters.push(this);\n    }\n\n    return this.generate(builder, output, uuid);\n  },\n  generate: function generate()\n  /* builder, output, uuid, type, ns */\n  {// This method needs to be implemented in subclasses\n  },\n  getHash: function getHash() {\n    var hash = '{';\n    var prop, obj;\n\n    for (prop in this) {\n      obj = this[prop];\n\n      if (obj instanceof Node) {\n        hash += '\"' + prop + '\":' + obj.getHash() + ',';\n      }\n    }\n\n    if (this.hashProperties) {\n      for (var i = 0; i < this.hashProperties.length; i++) {\n        prop = this.hashProperties[i];\n        obj = this[prop];\n        hash += '\"' + prop + '\":\"' + String(obj) + '\",';\n      }\n    }\n\n    hash += '\"id\":\"' + this.uuid + '\"}';\n    return hash;\n  },\n  appendDepsNode: function appendDepsNode(builder, data, output) {\n    data.deps = (data.deps || 0) + 1;\n    var outputLen = builder.getTypeLength(output);\n\n    if (outputLen > (data.outputMax || 0) || this.getType(builder, output)) {\n      data.outputMax = outputLen;\n      data.output = output;\n    }\n  },\n  setName: function setName(name) {\n    this.name = name;\n    return this;\n  },\n  getName: function getName()\n  /* builder */\n  {\n    return this.name;\n  },\n  getType: function getType(builder, output) {\n    return output === 'sampler2D' || output === 'samplerCube' ? output : this.type;\n  },\n  getJSONNode: function getJSONNode(meta) {\n    var isRootObject = meta === undefined || typeof meta === 'string';\n\n    if (!isRootObject && meta.nodes[this.uuid] !== undefined) {\n      return meta.nodes[this.uuid];\n    }\n  },\n  copy: function copy(source) {\n    if (source.name !== undefined) this.name = source.name;\n    if (source.userData !== undefined) this.userData = JSON.parse(JSON.stringify(source.userData));\n    return this;\n  },\n  createJSONNode: function createJSONNode(meta) {\n    var isRootObject = meta === undefined || typeof meta === 'string';\n    var data = {};\n    if (typeof this.nodeType !== 'string') throw new Error('Node does not allow serialization.');\n    data.uuid = this.uuid;\n    data.nodeType = this.nodeType;\n    if (this.name !== '') data.name = this.name;\n    if (JSON.stringify(this.userData) !== '{}') data.userData = this.userData;\n\n    if (!isRootObject) {\n      meta.nodes[this.uuid] = data;\n    }\n\n    return data;\n  },\n  toJSON: function toJSON(meta) {\n    return this.getJSONNode(meta) || this.createJSONNode(meta);\n  }\n};\nexport { Node };","map":{"version":3,"names":["MathUtils","Node","type","uuid","generateUUID","name","userData","prototype","constructor","isNode","hashProperties","undefined","analyze","builder","settings","analyzing","build","addFlow","slot","cache","context","clearVertexNodeCode","clearFragmentNodeCode","removeFlow","analyzeAndFlow","output","flow","result","code","clearNodeCode","extra","getType","data","getNodeData","appendDepsNode","nodes","indexOf","push","updateFrame","updaters","generate","getHash","hash","prop","obj","i","length","String","deps","outputLen","getTypeLength","outputMax","setName","getName","getJSONNode","meta","isRootObject","copy","source","JSON","parse","stringify","createJSONNode","nodeType","Error","toJSON"],"sources":["/Users/98yaroslavgorban/Desktop/gltfjsx-forked/node_modules/three-stdlib/nodes/core/Node.js"],"sourcesContent":["import { MathUtils } from 'three';\n\nfunction Node(type) {\n  this.uuid = MathUtils.generateUUID();\n  this.name = '';\n  this.type = type;\n  this.userData = {};\n}\n\nNode.prototype = {\n  constructor: Node,\n  isNode: true,\n  hashProperties: undefined,\n  analyze: function (builder, settings) {\n    settings = settings || {};\n    builder.analyzing = true;\n    this.build(builder.addFlow(settings.slot, settings.cache, settings.context), 'v4');\n    builder.clearVertexNodeCode();\n    builder.clearFragmentNodeCode();\n    builder.removeFlow();\n    builder.analyzing = false;\n  },\n  analyzeAndFlow: function (builder, output, settings) {\n    settings = settings || {};\n    this.analyze(builder, settings);\n    return this.flow(builder, output, settings);\n  },\n  flow: function (builder, output, settings) {\n    settings = settings || {};\n    builder.addFlow(settings.slot, settings.cache, settings.context);\n    var flow = {};\n    flow.result = this.build(builder, output);\n    flow.code = builder.clearNodeCode();\n    flow.extra = builder.context.extra;\n    builder.removeFlow();\n    return flow;\n  },\n  build: function (builder, output, uuid) {\n    output = output || this.getType(builder, output);\n    var data = builder.getNodeData(uuid || this);\n\n    if (builder.analyzing) {\n      this.appendDepsNode(builder, data, output);\n    }\n\n    if (builder.nodes.indexOf(this) === -1) {\n      builder.nodes.push(this);\n    }\n\n    if (this.updateFrame !== undefined && builder.updaters.indexOf(this) === -1) {\n      builder.updaters.push(this);\n    }\n\n    return this.generate(builder, output, uuid);\n  },\n  generate: function ()\n  /* builder, output, uuid, type, ns */\n  {// This method needs to be implemented in subclasses\n  },\n  getHash: function () {\n    var hash = '{';\n    var prop, obj;\n\n    for (prop in this) {\n      obj = this[prop];\n\n      if (obj instanceof Node) {\n        hash += '\"' + prop + '\":' + obj.getHash() + ',';\n      }\n    }\n\n    if (this.hashProperties) {\n      for (let i = 0; i < this.hashProperties.length; i++) {\n        prop = this.hashProperties[i];\n        obj = this[prop];\n        hash += '\"' + prop + '\":\"' + String(obj) + '\",';\n      }\n    }\n\n    hash += '\"id\":\"' + this.uuid + '\"}';\n    return hash;\n  },\n  appendDepsNode: function (builder, data, output) {\n    data.deps = (data.deps || 0) + 1;\n    var outputLen = builder.getTypeLength(output);\n\n    if (outputLen > (data.outputMax || 0) || this.getType(builder, output)) {\n      data.outputMax = outputLen;\n      data.output = output;\n    }\n  },\n  setName: function (name) {\n    this.name = name;\n    return this;\n  },\n  getName: function ()\n  /* builder */\n  {\n    return this.name;\n  },\n  getType: function (builder, output) {\n    return output === 'sampler2D' || output === 'samplerCube' ? output : this.type;\n  },\n  getJSONNode: function (meta) {\n    var isRootObject = meta === undefined || typeof meta === 'string';\n\n    if (!isRootObject && meta.nodes[this.uuid] !== undefined) {\n      return meta.nodes[this.uuid];\n    }\n  },\n  copy: function (source) {\n    if (source.name !== undefined) this.name = source.name;\n    if (source.userData !== undefined) this.userData = JSON.parse(JSON.stringify(source.userData));\n    return this;\n  },\n  createJSONNode: function (meta) {\n    var isRootObject = meta === undefined || typeof meta === 'string';\n    var data = {};\n    if (typeof this.nodeType !== 'string') throw new Error('Node does not allow serialization.');\n    data.uuid = this.uuid;\n    data.nodeType = this.nodeType;\n    if (this.name !== '') data.name = this.name;\n    if (JSON.stringify(this.userData) !== '{}') data.userData = this.userData;\n\n    if (!isRootObject) {\n      meta.nodes[this.uuid] = data;\n    }\n\n    return data;\n  },\n  toJSON: function (meta) {\n    return this.getJSONNode(meta) || this.createJSONNode(meta);\n  }\n};\n\nexport { Node };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
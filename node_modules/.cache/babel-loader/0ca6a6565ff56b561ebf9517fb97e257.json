{"ast":null,"code":"import { MathUtils } from 'three';\nimport { Node } from './Node.js';\n\nfunction TempNode(type, params) {\n  Node.call(this, type);\n  params = params || {};\n  this.shared = params.shared !== undefined ? params.shared : true;\n  this.unique = params.unique !== undefined ? params.unique : false;\n}\n\nTempNode.prototype = Object.create(Node.prototype);\nTempNode.prototype.constructor = TempNode;\n\nTempNode.prototype.build = function (builder, output, uuid, ns) {\n  output = output || this.getType(builder);\n\n  if (this.getShared(builder, output)) {\n    var isUnique = this.getUnique(builder, output);\n\n    if (isUnique && this.constructor.uuid === undefined) {\n      this.constructor.uuid = MathUtils.generateUUID();\n    }\n\n    uuid = builder.getUuid(uuid || this.getUuid(), !isUnique);\n    var data = builder.getNodeData(uuid),\n        type = data.output || this.getType(builder);\n\n    if (builder.analyzing) {\n      if ((data.deps || 0) > 0 || this.getLabel()) {\n        this.appendDepsNode(builder, data, output);\n        return this.generate(builder, output, uuid);\n      }\n\n      return Node.prototype.build.call(this, builder, output, uuid);\n    } else if (isUnique) {\n      data.name = data.name || Node.prototype.build.call(this, builder, output, uuid);\n      return data.name;\n    } else if (!this.getLabel() && (!this.getShared(builder, type) || builder.context.ignoreCache || data.deps === 1)) {\n      return Node.prototype.build.call(this, builder, output, uuid);\n    }\n\n    uuid = this.getUuid(false);\n    var name = this.getTemp(builder, uuid);\n\n    if (name) {\n      return builder.format(name, type, output);\n    } else {\n      name = TempNode.prototype.generate.call(this, builder, output, uuid, data.output, ns);\n      var code = this.generate(builder, type, uuid);\n      builder.addNodeCode(name + ' = ' + code + ';');\n      return builder.format(name, type, output);\n    }\n  }\n\n  return Node.prototype.build.call(this, builder, output, uuid);\n};\n\nTempNode.prototype.getShared = function (builder, output) {\n  return output !== 'sampler2D' && output !== 'samplerCube' && this.shared;\n};\n\nTempNode.prototype.getUnique = function ()\n/* builder, output */\n{\n  return this.unique;\n};\n\nTempNode.prototype.setLabel = function (name) {\n  this.label = name;\n  return this;\n};\n\nTempNode.prototype.getLabel = function ()\n/* builder */\n{\n  return this.label;\n};\n\nTempNode.prototype.getUuid = function (unique) {\n  var uuid = unique || unique == undefined ? this.constructor.uuid || this.uuid : this.uuid;\n  if (typeof this.scope === 'string') uuid = this.scope + '-' + uuid;\n  return uuid;\n};\n\nTempNode.prototype.getTemp = function (builder, uuid) {\n  uuid = uuid || this.uuid;\n  var tempVar = builder.getVars()[uuid];\n  return tempVar ? tempVar.name : undefined;\n};\n\nTempNode.prototype.generate = function (builder, output, uuid, type, ns) {\n  if (!this.getShared(builder, output)) console.error('THREE.TempNode is not shared!');\n  uuid = uuid || this.uuid;\n  return builder.getTempVar(uuid, type || this.getType(builder), ns, this.getLabel()).name;\n};\n\nexport { TempNode };","map":{"version":3,"names":["MathUtils","Node","TempNode","type","params","call","shared","undefined","unique","prototype","Object","create","constructor","build","builder","output","uuid","ns","getType","getShared","isUnique","getUnique","generateUUID","getUuid","data","getNodeData","analyzing","deps","getLabel","appendDepsNode","generate","name","context","ignoreCache","getTemp","format","code","addNodeCode","setLabel","label","scope","tempVar","getVars","console","error","getTempVar"],"sources":["/Users/98yaroslavgorban/Desktop/gltfjsx-forked/node_modules/three-stdlib/nodes/core/TempNode.js"],"sourcesContent":["import { MathUtils } from 'three';\nimport { Node } from './Node.js';\n\nfunction TempNode(type, params) {\n  Node.call(this, type);\n  params = params || {};\n  this.shared = params.shared !== undefined ? params.shared : true;\n  this.unique = params.unique !== undefined ? params.unique : false;\n}\n\nTempNode.prototype = Object.create(Node.prototype);\nTempNode.prototype.constructor = TempNode;\n\nTempNode.prototype.build = function (builder, output, uuid, ns) {\n  output = output || this.getType(builder);\n\n  if (this.getShared(builder, output)) {\n    var isUnique = this.getUnique(builder, output);\n\n    if (isUnique && this.constructor.uuid === undefined) {\n      this.constructor.uuid = MathUtils.generateUUID();\n    }\n\n    uuid = builder.getUuid(uuid || this.getUuid(), !isUnique);\n    var data = builder.getNodeData(uuid),\n        type = data.output || this.getType(builder);\n\n    if (builder.analyzing) {\n      if ((data.deps || 0) > 0 || this.getLabel()) {\n        this.appendDepsNode(builder, data, output);\n        return this.generate(builder, output, uuid);\n      }\n\n      return Node.prototype.build.call(this, builder, output, uuid);\n    } else if (isUnique) {\n      data.name = data.name || Node.prototype.build.call(this, builder, output, uuid);\n      return data.name;\n    } else if (!this.getLabel() && (!this.getShared(builder, type) || builder.context.ignoreCache || data.deps === 1)) {\n      return Node.prototype.build.call(this, builder, output, uuid);\n    }\n\n    uuid = this.getUuid(false);\n    var name = this.getTemp(builder, uuid);\n\n    if (name) {\n      return builder.format(name, type, output);\n    } else {\n      name = TempNode.prototype.generate.call(this, builder, output, uuid, data.output, ns);\n      var code = this.generate(builder, type, uuid);\n      builder.addNodeCode(name + ' = ' + code + ';');\n      return builder.format(name, type, output);\n    }\n  }\n\n  return Node.prototype.build.call(this, builder, output, uuid);\n};\n\nTempNode.prototype.getShared = function (builder, output) {\n  return output !== 'sampler2D' && output !== 'samplerCube' && this.shared;\n};\n\nTempNode.prototype.getUnique = function ()\n/* builder, output */\n{\n  return this.unique;\n};\n\nTempNode.prototype.setLabel = function (name) {\n  this.label = name;\n  return this;\n};\n\nTempNode.prototype.getLabel = function ()\n/* builder */\n{\n  return this.label;\n};\n\nTempNode.prototype.getUuid = function (unique) {\n  var uuid = unique || unique == undefined ? this.constructor.uuid || this.uuid : this.uuid;\n  if (typeof this.scope === 'string') uuid = this.scope + '-' + uuid;\n  return uuid;\n};\n\nTempNode.prototype.getTemp = function (builder, uuid) {\n  uuid = uuid || this.uuid;\n  var tempVar = builder.getVars()[uuid];\n  return tempVar ? tempVar.name : undefined;\n};\n\nTempNode.prototype.generate = function (builder, output, uuid, type, ns) {\n  if (!this.getShared(builder, output)) console.error('THREE.TempNode is not shared!');\n  uuid = uuid || this.uuid;\n  return builder.getTempVar(uuid, type || this.getType(builder), ns, this.getLabel()).name;\n};\n\nexport { TempNode };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
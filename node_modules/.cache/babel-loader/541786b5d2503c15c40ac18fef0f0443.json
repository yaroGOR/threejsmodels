{"ast":null,"code":"import { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { BokehShader } from '../shaders/BokehShader.js';\n/**\n * Depth-of-field post-process with bokeh shader\n */\n\nvar BokehPass = function BokehPass(scene, camera, params) {\n  this.scene = scene;\n  this.camera = camera;\n  var focus = params.focus !== undefined ? params.focus : 1.0;\n  var aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n  var aperture = params.aperture !== undefined ? params.aperture : 0.025;\n  var maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n  var width = params.width || window.innerWidth || 1;\n  var height = params.height || window.innerHeight || 1;\n  this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter\n  });\n  this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n  this.materialDepth = new MeshDepthMaterial();\n  this.materialDepth.depthPacking = RGBADepthPacking;\n  this.materialDepth.blending = NoBlending; // bokeh material\n\n  if (BokehShader === undefined) {\n    console.error('THREE.BokehPass relies on BokehShader');\n  }\n\n  var bokehShader = BokehShader;\n  var bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n  bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n  bokehUniforms['focus'].value = focus;\n  bokehUniforms['aspect'].value = aspect;\n  bokehUniforms['aperture'].value = aperture;\n  bokehUniforms['maxblur'].value = maxblur;\n  bokehUniforms['nearClip'].value = camera.near;\n  bokehUniforms['farClip'].value = camera.far;\n  this.materialBokeh = new ShaderMaterial({\n    defines: Object.assign({}, bokehShader.defines),\n    uniforms: bokehUniforms,\n    vertexShader: bokehShader.vertexShader,\n    fragmentShader: bokehShader.fragmentShader\n  });\n  this.uniforms = bokehUniforms;\n  this.needsSwap = false;\n  this.fsQuad = new FullScreenQuad(this.materialBokeh);\n  this._oldClearColor = new Color();\n};\n\nBokehPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: BokehPass,\n  render: function render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive*/\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    var oldClearAlpha = renderer.getClearAlpha();\n    var oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n});\nexport { BokehPass };","map":{"version":3,"names":["WebGLRenderTarget","NearestFilter","MeshDepthMaterial","RGBADepthPacking","NoBlending","UniformsUtils","ShaderMaterial","Color","FullScreenQuad","Pass","BokehShader","BokehPass","scene","camera","params","focus","undefined","aspect","aperture","maxblur","width","window","innerWidth","height","innerHeight","renderTargetDepth","minFilter","magFilter","texture","name","materialDepth","depthPacking","blending","console","error","bokehShader","bokehUniforms","clone","uniforms","value","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","needsSwap","fsQuad","_oldClearColor","prototype","create","constructor","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen"],"sources":["/Users/98yaroslavgorban/Desktop/gltfjsx-forked/node_modules/three-stdlib/postprocessing/BokehPass.js"],"sourcesContent":["import { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { FullScreenQuad, Pass } from './Pass.js';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\n/**\n * Depth-of-field post-process with bokeh shader\n */\n\nvar BokehPass = function (scene, camera, params) {\n  this.scene = scene;\n  this.camera = camera;\n  var focus = params.focus !== undefined ? params.focus : 1.0;\n  var aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n  var aperture = params.aperture !== undefined ? params.aperture : 0.025;\n  var maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n  var width = params.width || window.innerWidth || 1;\n  var height = params.height || window.innerHeight || 1;\n  this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n    minFilter: NearestFilter,\n    magFilter: NearestFilter\n  });\n  this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n  this.materialDepth = new MeshDepthMaterial();\n  this.materialDepth.depthPacking = RGBADepthPacking;\n  this.materialDepth.blending = NoBlending; // bokeh material\n\n  if (BokehShader === undefined) {\n    console.error('THREE.BokehPass relies on BokehShader');\n  }\n\n  var bokehShader = BokehShader;\n  var bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n  bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n  bokehUniforms['focus'].value = focus;\n  bokehUniforms['aspect'].value = aspect;\n  bokehUniforms['aperture'].value = aperture;\n  bokehUniforms['maxblur'].value = maxblur;\n  bokehUniforms['nearClip'].value = camera.near;\n  bokehUniforms['farClip'].value = camera.far;\n  this.materialBokeh = new ShaderMaterial({\n    defines: Object.assign({}, bokehShader.defines),\n    uniforms: bokehUniforms,\n    vertexShader: bokehShader.vertexShader,\n    fragmentShader: bokehShader.fragmentShader\n  });\n  this.uniforms = bokehUniforms;\n  this.needsSwap = false;\n  this.fsQuad = new FullScreenQuad(this.materialBokeh);\n  this._oldClearColor = new Color();\n};\n\nBokehPass.prototype = Object.assign(Object.create(Pass.prototype), {\n  constructor: BokehPass,\n  render: function (renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive*/\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    var oldClearAlpha = renderer.getClearAlpha();\n    var oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n});\n\nexport { BokehPass };\n"],"mappings":"AAAA,SAASA,iBAAT,EAA4BC,aAA5B,EAA2CC,iBAA3C,EAA8DC,gBAA9D,EAAgFC,UAAhF,EAA4FC,aAA5F,EAA2GC,cAA3G,EAA2HC,KAA3H,QAAwI,OAAxI;AACA,SAASC,cAAT,EAAyBC,IAAzB,QAAqC,WAArC;AACA,SAASC,WAAT,QAA4B,2BAA5B;AAEA;AACA;AACA;;AAEA,IAAIC,SAAS,GAAG,SAAZA,SAAY,CAAUC,KAAV,EAAiBC,MAAjB,EAAyBC,MAAzB,EAAiC;EAC/C,KAAKF,KAAL,GAAaA,KAAb;EACA,KAAKC,MAAL,GAAcA,MAAd;EACA,IAAIE,KAAK,GAAGD,MAAM,CAACC,KAAP,KAAiBC,SAAjB,GAA6BF,MAAM,CAACC,KAApC,GAA4C,GAAxD;EACA,IAAIE,MAAM,GAAGH,MAAM,CAACG,MAAP,KAAkBD,SAAlB,GAA8BF,MAAM,CAACG,MAArC,GAA8CJ,MAAM,CAACI,MAAlE;EACA,IAAIC,QAAQ,GAAGJ,MAAM,CAACI,QAAP,KAAoBF,SAApB,GAAgCF,MAAM,CAACI,QAAvC,GAAkD,KAAjE;EACA,IAAIC,OAAO,GAAGL,MAAM,CAACK,OAAP,KAAmBH,SAAnB,GAA+BF,MAAM,CAACK,OAAtC,GAAgD,GAA9D,CAN+C,CAMoB;;EAEnE,IAAIC,KAAK,GAAGN,MAAM,CAACM,KAAP,IAAgBC,MAAM,CAACC,UAAvB,IAAqC,CAAjD;EACA,IAAIC,MAAM,GAAGT,MAAM,CAACS,MAAP,IAAiBF,MAAM,CAACG,WAAxB,IAAuC,CAApD;EACA,KAAKC,iBAAL,GAAyB,IAAIzB,iBAAJ,CAAsBoB,KAAtB,EAA6BG,MAA7B,EAAqC;IAC5DG,SAAS,EAAEzB,aADiD;IAE5D0B,SAAS,EAAE1B;EAFiD,CAArC,CAAzB;EAIA,KAAKwB,iBAAL,CAAuBG,OAAvB,CAA+BC,IAA/B,GAAsC,iBAAtC,CAd+C,CAcU;;EAEzD,KAAKC,aAAL,GAAqB,IAAI5B,iBAAJ,EAArB;EACA,KAAK4B,aAAL,CAAmBC,YAAnB,GAAkC5B,gBAAlC;EACA,KAAK2B,aAAL,CAAmBE,QAAnB,GAA8B5B,UAA9B,CAlB+C,CAkBL;;EAE1C,IAAIM,WAAW,KAAKM,SAApB,EAA+B;IAC7BiB,OAAO,CAACC,KAAR,CAAc,uCAAd;EACD;;EAED,IAAIC,WAAW,GAAGzB,WAAlB;EACA,IAAI0B,aAAa,GAAG/B,aAAa,CAACgC,KAAd,CAAoBF,WAAW,CAACG,QAAhC,CAApB;EACAF,aAAa,CAAC,QAAD,CAAb,CAAwBG,KAAxB,GAAgC,KAAKd,iBAAL,CAAuBG,OAAvD;EACAQ,aAAa,CAAC,OAAD,CAAb,CAAuBG,KAAvB,GAA+BxB,KAA/B;EACAqB,aAAa,CAAC,QAAD,CAAb,CAAwBG,KAAxB,GAAgCtB,MAAhC;EACAmB,aAAa,CAAC,UAAD,CAAb,CAA0BG,KAA1B,GAAkCrB,QAAlC;EACAkB,aAAa,CAAC,SAAD,CAAb,CAAyBG,KAAzB,GAAiCpB,OAAjC;EACAiB,aAAa,CAAC,UAAD,CAAb,CAA0BG,KAA1B,GAAkC1B,MAAM,CAAC2B,IAAzC;EACAJ,aAAa,CAAC,SAAD,CAAb,CAAyBG,KAAzB,GAAiC1B,MAAM,CAAC4B,GAAxC;EACA,KAAKC,aAAL,GAAqB,IAAIpC,cAAJ,CAAmB;IACtCqC,OAAO,EAAEC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBV,WAAW,CAACQ,OAA9B,CAD6B;IAEtCL,QAAQ,EAAEF,aAF4B;IAGtCU,YAAY,EAAEX,WAAW,CAACW,YAHY;IAItCC,cAAc,EAAEZ,WAAW,CAACY;EAJU,CAAnB,CAArB;EAMA,KAAKT,QAAL,GAAgBF,aAAhB;EACA,KAAKY,SAAL,GAAiB,KAAjB;EACA,KAAKC,MAAL,GAAc,IAAIzC,cAAJ,CAAmB,KAAKkC,aAAxB,CAAd;EACA,KAAKQ,cAAL,GAAsB,IAAI3C,KAAJ,EAAtB;AACD,CA3CD;;AA6CAI,SAAS,CAACwC,SAAV,GAAsBP,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACQ,MAAP,CAAc3C,IAAI,CAAC0C,SAAnB,CAAd,EAA6C;EACjEE,WAAW,EAAE1C,SADoD;EAEjE2C,MAAM,EAAE,gBAAUC,QAAV,EAAoBC,WAApB,EAAiCC;EACzC;EADQ,EAEN;IACA;IACA,KAAK7C,KAAL,CAAW8C,gBAAX,GAA8B,KAAK5B,aAAnC;IACAyB,QAAQ,CAACI,aAAT,CAAuB,KAAKT,cAA5B;IACA,IAAIU,aAAa,GAAGL,QAAQ,CAACM,aAAT,EAApB;IACA,IAAIC,YAAY,GAAGP,QAAQ,CAACQ,SAA5B;IACAR,QAAQ,CAACQ,SAAT,GAAqB,KAArB;IACAR,QAAQ,CAACS,aAAT,CAAuB,QAAvB;IACAT,QAAQ,CAACU,aAAT,CAAuB,GAAvB;IACAV,QAAQ,CAACW,eAAT,CAAyB,KAAKzC,iBAA9B;IACA8B,QAAQ,CAACY,KAAT;IACAZ,QAAQ,CAACD,MAAT,CAAgB,KAAK1C,KAArB,EAA4B,KAAKC,MAAjC,EAXA,CAW0C;;IAE1C,KAAKyB,QAAL,CAAc,QAAd,EAAwBC,KAAxB,GAAgCkB,UAAU,CAAC7B,OAA3C;IACA,KAAKU,QAAL,CAAc,UAAd,EAA0BC,KAA1B,GAAkC,KAAK1B,MAAL,CAAY2B,IAA9C;IACA,KAAKF,QAAL,CAAc,SAAd,EAAyBC,KAAzB,GAAiC,KAAK1B,MAAL,CAAY4B,GAA7C;;IAEA,IAAI,KAAK2B,cAAT,EAAyB;MACvBb,QAAQ,CAACW,eAAT,CAAyB,IAAzB;MACA,KAAKjB,MAAL,CAAYK,MAAZ,CAAmBC,QAAnB;IACD,CAHD,MAGO;MACLA,QAAQ,CAACW,eAAT,CAAyBV,WAAzB;MACAD,QAAQ,CAACY,KAAT;MACA,KAAKlB,MAAL,CAAYK,MAAZ,CAAmBC,QAAnB;IACD;;IAED,KAAK3C,KAAL,CAAW8C,gBAAX,GAA8B,IAA9B;IACAH,QAAQ,CAACS,aAAT,CAAuB,KAAKd,cAA5B;IACAK,QAAQ,CAACU,aAAT,CAAuBL,aAAvB;IACAL,QAAQ,CAACQ,SAAT,GAAqBD,YAArB;EACD;AAlCgE,CAA7C,CAAtB;AAqCA,SAASnD,SAAT"},"metadata":{},"sourceType":"module"}
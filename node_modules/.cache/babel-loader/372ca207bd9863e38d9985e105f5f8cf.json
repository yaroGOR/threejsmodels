{"ast":null,"code":"import { CubeUVRefractionMapping, CubeUVReflectionMapping, CubeRefractionMapping, CubeReflectionMapping, LinearEncoding, GammaEncoding } from 'three';\nimport { NodeUniform } from './NodeUniform.js';\nimport { NodeUtils } from './NodeUtils.js';\nimport { NodeLib } from './NodeLib.js';\nimport { FunctionNode } from './FunctionNode.js';\nimport { ConstNode } from './ConstNode.js';\nimport { StructNode } from './StructNode.js';\nimport { Vector2Node } from '../inputs/Vector2Node.js';\nimport { Vector3Node } from '../inputs/Vector3Node.js';\nimport { Vector4Node } from '../inputs/Vector4Node.js';\nimport { TextureNode } from '../inputs/TextureNode.js';\nimport { CubeTextureNode } from '../inputs/CubeTextureNode.js';\nimport { TextureCubeNode } from '../misc/TextureCubeNode.js';\nvar elements = NodeUtils.elements,\n    constructors = ['float', 'vec2', 'vec3', 'vec4'],\n    convertFormatToType = {\n  float: 'f',\n  vec2: 'v2',\n  vec3: 'v3',\n  vec4: 'v4',\n  mat4: 'v4',\n  int: 'i',\n  bool: 'b'\n},\n    convertTypeToFormat = {\n  t: 'sampler2D',\n  tc: 'samplerCube',\n  b: 'bool',\n  i: 'int',\n  f: 'float',\n  c: 'vec3',\n  v2: 'vec2',\n  v3: 'vec3',\n  v4: 'vec4',\n  m3: 'mat3',\n  m4: 'mat4'\n};\n\nfunction NodeBuilder() {\n  this.slots = [];\n  this.caches = [];\n  this.contexts = [];\n  this.keywords = {};\n  this.nodeData = {};\n  this.requires = {\n    uv: [],\n    color: [],\n    lights: false,\n    fog: false,\n    transparent: false,\n    irradiance: false\n  };\n  this.includes = {\n    consts: [],\n    functions: [],\n    structs: []\n  };\n  this.attributes = {};\n  this.prefixCode = ['#ifdef TEXTURE_LOD_EXT', '\t#define texCube(a, b) textureCube(a, b)', '\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)', '\t#define tex2D(a, b) texture2D(a, b)', '\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)', '#else', '\t#define texCube(a, b) textureCube(a, b)', '\t#define texCubeBias(a, b, c) textureCube(a, b, c)', '\t#define tex2D(a, b) texture2D(a, b)', '\t#define tex2DBias(a, b, c) texture2D(a, b, c)', '#endif', '#include <packing>', '#include <common>'].join('\\n');\n  this.parsCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.code = {\n    vertex: '',\n    fragment: ''\n  };\n  this.nodeCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.resultCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.finalCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.inputs = {\n    uniforms: {\n      list: [],\n      vertex: [],\n      fragment: []\n    },\n    vars: {\n      varying: [],\n      vertex: [],\n      fragment: []\n    }\n  }; // send to material\n\n  this.defines = {};\n  this.uniforms = {};\n  this.extensions = {};\n  this.updaters = [];\n  this.nodes = []; // --\n\n  this.analyzing = false;\n}\n\nNodeBuilder.prototype = {\n  constructor: NodeBuilder,\n  build: function build(vertex, fragment) {\n    this.buildShader('vertex', vertex);\n    this.buildShader('fragment', fragment);\n\n    for (var i = 0; i < this.requires.uv.length; i++) {\n      if (this.requires.uv[i]) {\n        var uvIndex = i > 0 ? i + 1 : '';\n        this.addVaryCode('varying vec2 vUv' + uvIndex + ';');\n\n        if (i > 0) {\n          this.addVertexParsCode('attribute vec2 uv' + uvIndex + ';');\n        }\n\n        this.addVertexFinalCode('vUv' + uvIndex + ' = uv' + uvIndex + ';');\n      }\n    }\n\n    if (this.requires.color[0]) {\n      this.addVaryCode('varying vec4 vColor;');\n      this.addVertexParsCode('attribute vec4 color;');\n      this.addVertexFinalCode('vColor = color;');\n    }\n\n    if (this.requires.color[1]) {\n      this.addVaryCode('varying vec4 vColor2;');\n      this.addVertexParsCode('attribute vec4 color2;');\n      this.addVertexFinalCode('vColor2 = color2;');\n    }\n\n    if (this.requires.position) {\n      this.addVaryCode('varying vec3 vPosition;');\n      this.addVertexFinalCode('vPosition = transformed;');\n    }\n\n    if (this.requires.worldPosition) {\n      this.addVaryCode('varying vec3 vWPosition;');\n      this.addVertexFinalCode('vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;');\n    }\n\n    if (this.requires.normal) {\n      this.addVaryCode('varying vec3 vObjectNormal;');\n      this.addVertexFinalCode('vObjectNormal = normal;');\n    }\n\n    if (this.requires.worldNormal) {\n      this.addVaryCode('varying vec3 vWNormal;');\n      this.addVertexFinalCode('vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;');\n    }\n\n    return this;\n  },\n  buildShader: function buildShader(shader, node) {\n    this.resultCode[shader] = node.build(this.setShader(shader), 'v4');\n  },\n  setMaterial: function setMaterial(material, renderer) {\n    this.material = material;\n    this.renderer = renderer;\n    this.requires.lights = material.lights;\n    this.requires.fog = material.fog;\n    this.mergeDefines(material.defines);\n    return this;\n  },\n  addFlow: function addFlow(slot, cache, context) {\n    return this.addSlot(slot).addCache(cache).addContext(context);\n  },\n  removeFlow: function removeFlow() {\n    return this.removeSlot().removeCache().removeContext();\n  },\n  addCache: function addCache(name) {\n    this.cache = name || '';\n    this.caches.push(this.cache);\n    return this;\n  },\n  removeCache: function removeCache() {\n    this.caches.pop();\n    this.cache = this.caches[this.caches.length - 1] || '';\n    return this;\n  },\n  addContext: function addContext(context) {\n    this.context = Object.assign({}, this.context, context);\n    this.context.extra = this.context.extra || {};\n    this.contexts.push(this.context);\n    return this;\n  },\n  removeContext: function removeContext() {\n    this.contexts.pop();\n    this.context = this.contexts[this.contexts.length - 1] || {};\n    return this;\n  },\n  addSlot: function addSlot(name) {\n    this.slot = name || '';\n    this.slots.push(this.slot);\n    return this;\n  },\n  removeSlot: function removeSlot() {\n    this.slots.pop();\n    this.slot = this.slots[this.slots.length - 1] || '';\n    return this;\n  },\n  addVertexCode: function addVertexCode(code) {\n    this.addCode(code, 'vertex');\n  },\n  addFragmentCode: function addFragmentCode(code) {\n    this.addCode(code, 'fragment');\n  },\n  addCode: function addCode(code, shader) {\n    this.code[shader || this.shader] += code + '\\n';\n  },\n  addVertexNodeCode: function addVertexNodeCode(code) {\n    this.addNodeCode(code, 'vertex');\n  },\n  addFragmentNodeCode: function addFragmentNodeCode(code) {\n    this.addNodeCode(code, 'fragment');\n  },\n  addNodeCode: function addNodeCode(code, shader) {\n    this.nodeCode[shader || this.shader] += code + '\\n';\n  },\n  clearNodeCode: function clearNodeCode(shader) {\n    shader = shader || this.shader;\n    var code = this.nodeCode[shader];\n    this.nodeCode[shader] = '';\n    return code;\n  },\n  clearVertexNodeCode: function clearVertexNodeCode() {\n    return this.clearNodeCode('vertex');\n  },\n  clearFragmentNodeCode: function clearFragmentNodeCode() {\n    return this.clearNodeCode('fragment');\n  },\n  addVertexFinalCode: function addVertexFinalCode(code) {\n    this.addFinalCode(code, 'vertex');\n  },\n  addFragmentFinalCode: function addFragmentFinalCode(code) {\n    this.addFinalCode(code, 'fragment');\n  },\n  addFinalCode: function addFinalCode(code, shader) {\n    this.finalCode[shader || this.shader] += code + '\\n';\n  },\n  addVertexParsCode: function addVertexParsCode(code) {\n    this.addParsCode(code, 'vertex');\n  },\n  addFragmentParsCode: function addFragmentParsCode(code) {\n    this.addParsCode(code, 'fragment');\n  },\n  addParsCode: function addParsCode(code, shader) {\n    this.parsCode[shader || this.shader] += code + '\\n';\n  },\n  addVaryCode: function addVaryCode(code) {\n    this.addVertexParsCode(code);\n    this.addFragmentParsCode(code);\n  },\n  isCache: function isCache(name) {\n    return this.caches.indexOf(name) !== -1;\n  },\n  isSlot: function isSlot(name) {\n    return this.slots.indexOf(name) !== -1;\n  },\n  define: function define(name, value) {\n    this.defines[name] = value === undefined ? 1 : value;\n  },\n  require: function require(name) {\n    this.requires[name] = true;\n  },\n  isDefined: function isDefined(name) {\n    return this.defines[name] !== undefined;\n  },\n  getVar: function getVar(uuid, type, ns) {\n    var shader = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'varying';\n    var prefix = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'V';\n    var label = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : '';\n    var vars = this.getVars(shader),\n        data = vars[uuid];\n\n    if (!data) {\n      var index = vars.length,\n          name = ns ? ns : 'node' + prefix + index + (label ? '_' + label : '');\n      data = {\n        name: name,\n        type: type\n      };\n      vars.push(data);\n      vars[uuid] = data;\n    }\n\n    return data;\n  },\n  getTempVar: function getTempVar(uuid, type, ns, label) {\n    return this.getVar(uuid, type, ns, this.shader, 'T', label);\n  },\n  getAttribute: function getAttribute(name, type) {\n    if (!this.attributes[name]) {\n      var varying = this.getVar(name, type);\n      this.addVertexParsCode('attribute ' + type + ' ' + name + ';');\n      this.addVertexFinalCode(varying.name + ' = ' + name + ';');\n      this.attributes[name] = {\n        varying: varying,\n        name: name,\n        type: type\n      };\n    }\n\n    return this.attributes[name];\n  },\n  getCode: function getCode(shader) {\n    return [this.prefixCode, this.parsCode[shader], this.getVarListCode(this.getVars('varying'), 'varying'), this.getVarListCode(this.inputs.uniforms[shader], 'uniform'), this.getIncludesCode('consts', shader), this.getIncludesCode('structs', shader), this.getIncludesCode('functions', shader), 'void main() {', this.getVarListCode(this.getVars(shader)), this.code[shader], this.resultCode[shader], this.finalCode[shader], '}'].join('\\n');\n  },\n  getVarListCode: function getVarListCode(vars, prefix) {\n    prefix = prefix || '';\n    var code = '';\n\n    for (var i = 0, l = vars.length; i < l; ++i) {\n      var nVar = vars[i],\n          type = nVar.type,\n          name = nVar.name;\n      var formatType = this.getFormatByType(type);\n\n      if (formatType === undefined) {\n        throw new Error('Node pars ' + formatType + ' not found.');\n      }\n\n      code += prefix + ' ' + formatType + ' ' + name + ';\\n';\n    }\n\n    return code;\n  },\n  getVars: function getVars(shader) {\n    return this.inputs.vars[shader || this.shader];\n  },\n  getNodeData: function getNodeData(node) {\n    var uuid = node.isNode ? node.uuid : node;\n    return this.nodeData[uuid] = this.nodeData[uuid] || {};\n  },\n  createUniform: function createUniform(shader, type, node, ns, needsUpdate, label) {\n    var uniforms = this.inputs.uniforms,\n        index = uniforms.list.length;\n    var uniform = new NodeUniform({\n      type: type,\n      name: ns ? ns : 'nodeU' + index + (label ? '_' + label : ''),\n      node: node,\n      needsUpdate: needsUpdate\n    });\n    uniforms.list.push(uniform);\n    uniforms[shader].push(uniform);\n    uniforms[shader][uniform.name] = uniform;\n    this.uniforms[uniform.name] = uniform;\n    return uniform;\n  },\n  createVertexUniform: function createVertexUniform(type, node, ns, needsUpdate, label) {\n    return this.createUniform('vertex', type, node, ns, needsUpdate, label);\n  },\n  createFragmentUniform: function createFragmentUniform(type, node, ns, needsUpdate, label) {\n    return this.createUniform('fragment', type, node, ns, needsUpdate, label);\n  },\n  include: function include(node, parent, source) {\n    var includesStruct;\n    node = typeof node === 'string' ? NodeLib.get(node) : node;\n\n    if (this.context.include === false) {\n      return node.name;\n    }\n\n    if (node instanceof FunctionNode) {\n      includesStruct = this.includes.functions;\n    } else if (node instanceof ConstNode) {\n      includesStruct = this.includes.consts;\n    } else if (node instanceof StructNode) {\n      includesStruct = this.includes.structs;\n    }\n\n    var includes = includesStruct[this.shader] = includesStruct[this.shader] || [];\n\n    if (node) {\n      var included = includes[node.name];\n\n      if (!included) {\n        included = includes[node.name] = {\n          node: node,\n          deps: []\n        };\n        includes.push(included);\n        included.src = node.build(this, 'source');\n      }\n\n      if (node instanceof FunctionNode && parent && includes[parent.name] && includes[parent.name].deps.indexOf(node) == -1) {\n        includes[parent.name].deps.push(node);\n\n        if (node.includes && node.includes.length) {\n          var i = 0;\n\n          do {\n            this.include(node.includes[i++], parent);\n          } while (i < node.includes.length);\n        }\n      }\n\n      if (source) {\n        included.src = source;\n      }\n\n      return node.name;\n    } else {\n      throw new Error('Include not found.');\n    }\n  },\n  colorToVectorProperties: function colorToVectorProperties(color) {\n    return color.replace('r', 'x').replace('g', 'y').replace('b', 'z').replace('a', 'w');\n  },\n  colorToVector: function colorToVector(color) {\n    return color.replace(/c/g, 'v3');\n  },\n  getIncludes: function getIncludes(type, shader) {\n    return this.includes[type][shader || this.shader];\n  },\n  getIncludesCode: function () {\n    function sortByPosition(a, b) {\n      return a.deps.length - b.deps.length;\n    }\n\n    return function getIncludesCode(type, shader) {\n      var includes = this.getIncludes(type, shader);\n      if (!includes) return '';\n      var code = '',\n          includes = includes.sort(sortByPosition);\n\n      for (var i = 0; i < includes.length; i++) {\n        if (includes[i].src) code += includes[i].src + '\\n';\n      }\n\n      return code;\n    };\n  }(),\n  getConstructorFromLength: function getConstructorFromLength(len) {\n    return constructors[len - 1];\n  },\n  isTypeMatrix: function isTypeMatrix(format) {\n    return /^m/.test(format);\n  },\n  getTypeLength: function getTypeLength(type) {\n    if (type === 'f') return 1;\n    return parseInt(this.colorToVector(type).substr(1));\n  },\n  getTypeFromLength: function getTypeFromLength(len) {\n    if (len === 1) return 'f';\n    return 'v' + len;\n  },\n  findNode: function findNode() {\n    for (var i = 0; i < arguments.length; i++) {\n      var nodeCandidate = arguments[i];\n\n      if (nodeCandidate !== undefined && nodeCandidate.isNode) {\n        return nodeCandidate;\n      }\n    }\n  },\n  resolve: function resolve() {\n    for (var i = 0; i < arguments.length; i++) {\n      var nodeCandidate = arguments[i];\n\n      if (nodeCandidate !== undefined) {\n        if (nodeCandidate.isNode) {\n          return nodeCandidate;\n        } else if (nodeCandidate.isTexture) {\n          switch (nodeCandidate.mapping) {\n            case CubeReflectionMapping:\n            case CubeRefractionMapping:\n              return new CubeTextureNode(nodeCandidate);\n\n            case CubeUVReflectionMapping:\n            case CubeUVRefractionMapping:\n              return new TextureCubeNode(new TextureNode(nodeCandidate));\n\n            default:\n              return new TextureNode(nodeCandidate);\n          }\n        } else if (nodeCandidate.isVector2) {\n          return new Vector2Node(nodeCandidate);\n        } else if (nodeCandidate.isVector3) {\n          return new Vector3Node(nodeCandidate);\n        } else if (nodeCandidate.isVector4) {\n          return new Vector4Node(nodeCandidate);\n        }\n      }\n    }\n  },\n  format: function format(code, from, to) {\n    var typeToType = this.colorToVector(to + ' <- ' + from);\n\n    switch (typeToType) {\n      case 'f <- v2':\n        return code + '.x';\n\n      case 'f <- v3':\n        return code + '.x';\n\n      case 'f <- v4':\n        return code + '.x';\n\n      case 'f <- i':\n      case 'f <- b':\n        return 'float( ' + code + ' )';\n\n      case 'v2 <- f':\n        return 'vec2( ' + code + ' )';\n\n      case 'v2 <- v3':\n        return code + '.xy';\n\n      case 'v2 <- v4':\n        return code + '.xy';\n\n      case 'v2 <- i':\n      case 'v2 <- b':\n        return 'vec2( float( ' + code + ' ) )';\n\n      case 'v3 <- f':\n        return 'vec3( ' + code + ' )';\n\n      case 'v3 <- v2':\n        return 'vec3( ' + code + ', 0.0 )';\n\n      case 'v3 <- v4':\n        return code + '.xyz';\n\n      case 'v3 <- i':\n      case 'v3 <- b':\n        return 'vec2( float( ' + code + ' ) )';\n\n      case 'v4 <- f':\n        return 'vec4( ' + code + ' )';\n\n      case 'v4 <- v2':\n        return 'vec4( ' + code + ', 0.0, 1.0 )';\n\n      case 'v4 <- v3':\n        return 'vec4( ' + code + ', 1.0 )';\n\n      case 'v4 <- i':\n      case 'v4 <- b':\n        return 'vec4( float( ' + code + ' ) )';\n\n      case 'i <- f':\n      case 'i <- b':\n        return 'int( ' + code + ' )';\n\n      case 'i <- v2':\n        return 'int( ' + code + '.x )';\n\n      case 'i <- v3':\n        return 'int( ' + code + '.x )';\n\n      case 'i <- v4':\n        return 'int( ' + code + '.x )';\n\n      case 'b <- f':\n        return '( ' + code + ' != 0.0 )';\n\n      case 'b <- v2':\n        return '( ' + code + ' != vec2( 0.0 ) )';\n\n      case 'b <- v3':\n        return '( ' + code + ' != vec3( 0.0 ) )';\n\n      case 'b <- v4':\n        return '( ' + code + ' != vec4( 0.0 ) )';\n\n      case 'b <- i':\n        return '( ' + code + ' != 0 )';\n    }\n\n    return code;\n  },\n  getTypeByFormat: function getTypeByFormat(format) {\n    return convertFormatToType[format] || format;\n  },\n  getFormatByType: function getFormatByType(type) {\n    return convertTypeToFormat[type] || type;\n  },\n  getUuid: function getUuid(uuid, useCache) {\n    useCache = useCache !== undefined ? useCache : true;\n    if (useCache && this.cache) uuid = this.cache + '-' + uuid;\n    return uuid;\n  },\n  getElementByIndex: function getElementByIndex(index) {\n    return elements[index];\n  },\n  getIndexByElement: function getIndexByElement(elm) {\n    return elements.indexOf(elm);\n  },\n  isShader: function isShader(shader) {\n    return this.shader === shader;\n  },\n  setShader: function setShader(shader) {\n    this.shader = shader;\n    return this;\n  },\n  mergeDefines: function mergeDefines(defines) {\n    for (var name in defines) {\n      this.defines[name] = defines[name];\n    }\n\n    return this.defines;\n  },\n  mergeUniform: function mergeUniform(uniforms) {\n    for (var name in uniforms) {\n      this.uniforms[name] = uniforms[name];\n    }\n\n    return this.uniforms;\n  },\n  getTextureEncodingFromMap: function getTextureEncodingFromMap(map) {\n    var encoding;\n\n    if (!map) {\n      encoding = LinearEncoding;\n    } else if (map.isTexture) {\n      encoding = map.encoding;\n    } else if (map.isWebGLRenderTarget) {\n      console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\");\n      encoding = map.texture.encoding;\n    }\n\n    if (encoding === LinearEncoding && this.context.gamma) {\n      encoding = GammaEncoding;\n    }\n\n    return encoding;\n  }\n};\nexport { NodeBuilder };","map":{"version":3,"names":["CubeUVRefractionMapping","CubeUVReflectionMapping","CubeRefractionMapping","CubeReflectionMapping","LinearEncoding","GammaEncoding","NodeUniform","NodeUtils","NodeLib","FunctionNode","ConstNode","StructNode","Vector2Node","Vector3Node","Vector4Node","TextureNode","CubeTextureNode","TextureCubeNode","elements","constructors","convertFormatToType","float","vec2","vec3","vec4","mat4","int","bool","convertTypeToFormat","t","tc","b","i","f","c","v2","v3","v4","m3","m4","NodeBuilder","slots","caches","contexts","keywords","nodeData","requires","uv","color","lights","fog","transparent","irradiance","includes","consts","functions","structs","attributes","prefixCode","join","parsCode","vertex","fragment","code","nodeCode","resultCode","finalCode","inputs","uniforms","list","vars","varying","defines","extensions","updaters","nodes","analyzing","prototype","constructor","build","buildShader","length","uvIndex","addVaryCode","addVertexParsCode","addVertexFinalCode","position","worldPosition","normal","worldNormal","shader","node","setShader","setMaterial","material","renderer","mergeDefines","addFlow","slot","cache","context","addSlot","addCache","addContext","removeFlow","removeSlot","removeCache","removeContext","name","push","pop","Object","assign","extra","addVertexCode","addCode","addFragmentCode","addVertexNodeCode","addNodeCode","addFragmentNodeCode","clearNodeCode","clearVertexNodeCode","clearFragmentNodeCode","addFinalCode","addFragmentFinalCode","addParsCode","addFragmentParsCode","isCache","indexOf","isSlot","define","value","undefined","require","isDefined","getVar","uuid","type","ns","prefix","label","getVars","data","index","getTempVar","getAttribute","getCode","getVarListCode","getIncludesCode","l","nVar","formatType","getFormatByType","Error","getNodeData","isNode","createUniform","needsUpdate","uniform","createVertexUniform","createFragmentUniform","include","parent","source","includesStruct","get","included","deps","src","colorToVectorProperties","replace","colorToVector","getIncludes","sortByPosition","a","sort","getConstructorFromLength","len","isTypeMatrix","format","test","getTypeLength","parseInt","substr","getTypeFromLength","findNode","arguments","nodeCandidate","resolve","isTexture","mapping","isVector2","isVector3","isVector4","from","to","typeToType","getTypeByFormat","getUuid","useCache","getElementByIndex","getIndexByElement","elm","isShader","mergeUniform","getTextureEncodingFromMap","map","encoding","isWebGLRenderTarget","console","warn","texture","gamma"],"sources":["/Users/98yaroslavgorban/Desktop/gltfjsx-forked/node_modules/three-stdlib/nodes/core/NodeBuilder.js"],"sourcesContent":["import { CubeUVRefractionMapping, CubeUVReflectionMapping, CubeRefractionMapping, CubeReflectionMapping, LinearEncoding, GammaEncoding } from 'three';\nimport { NodeUniform } from './NodeUniform.js';\nimport { NodeUtils } from './NodeUtils.js';\nimport { NodeLib } from './NodeLib.js';\nimport { FunctionNode } from './FunctionNode.js';\nimport { ConstNode } from './ConstNode.js';\nimport { StructNode } from './StructNode.js';\nimport { Vector2Node } from '../inputs/Vector2Node.js';\nimport { Vector3Node } from '../inputs/Vector3Node.js';\nimport { Vector4Node } from '../inputs/Vector4Node.js';\nimport { TextureNode } from '../inputs/TextureNode.js';\nimport { CubeTextureNode } from '../inputs/CubeTextureNode.js';\nimport { TextureCubeNode } from '../misc/TextureCubeNode.js';\n\nvar elements = NodeUtils.elements,\n    constructors = ['float', 'vec2', 'vec3', 'vec4'],\n    convertFormatToType = {\n  float: 'f',\n  vec2: 'v2',\n  vec3: 'v3',\n  vec4: 'v4',\n  mat4: 'v4',\n  int: 'i',\n  bool: 'b'\n},\n    convertTypeToFormat = {\n  t: 'sampler2D',\n  tc: 'samplerCube',\n  b: 'bool',\n  i: 'int',\n  f: 'float',\n  c: 'vec3',\n  v2: 'vec2',\n  v3: 'vec3',\n  v4: 'vec4',\n  m3: 'mat3',\n  m4: 'mat4'\n};\n\nfunction NodeBuilder() {\n  this.slots = [];\n  this.caches = [];\n  this.contexts = [];\n  this.keywords = {};\n  this.nodeData = {};\n  this.requires = {\n    uv: [],\n    color: [],\n    lights: false,\n    fog: false,\n    transparent: false,\n    irradiance: false\n  };\n  this.includes = {\n    consts: [],\n    functions: [],\n    structs: []\n  };\n  this.attributes = {};\n  this.prefixCode = ['#ifdef TEXTURE_LOD_EXT', '\t#define texCube(a, b) textureCube(a, b)', '\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)', '\t#define tex2D(a, b) texture2D(a, b)', '\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)', '#else', '\t#define texCube(a, b) textureCube(a, b)', '\t#define texCubeBias(a, b, c) textureCube(a, b, c)', '\t#define tex2D(a, b) texture2D(a, b)', '\t#define tex2DBias(a, b, c) texture2D(a, b, c)', '#endif', '#include <packing>', '#include <common>'].join('\\n');\n  this.parsCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.code = {\n    vertex: '',\n    fragment: ''\n  };\n  this.nodeCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.resultCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.finalCode = {\n    vertex: '',\n    fragment: ''\n  };\n  this.inputs = {\n    uniforms: {\n      list: [],\n      vertex: [],\n      fragment: []\n    },\n    vars: {\n      varying: [],\n      vertex: [],\n      fragment: []\n    }\n  }; // send to material\n\n  this.defines = {};\n  this.uniforms = {};\n  this.extensions = {};\n  this.updaters = [];\n  this.nodes = []; // --\n\n  this.analyzing = false;\n}\n\nNodeBuilder.prototype = {\n  constructor: NodeBuilder,\n  build: function (vertex, fragment) {\n    this.buildShader('vertex', vertex);\n    this.buildShader('fragment', fragment);\n\n    for (let i = 0; i < this.requires.uv.length; i++) {\n      if (this.requires.uv[i]) {\n        var uvIndex = i > 0 ? i + 1 : '';\n        this.addVaryCode('varying vec2 vUv' + uvIndex + ';');\n\n        if (i > 0) {\n          this.addVertexParsCode('attribute vec2 uv' + uvIndex + ';');\n        }\n\n        this.addVertexFinalCode('vUv' + uvIndex + ' = uv' + uvIndex + ';');\n      }\n    }\n\n    if (this.requires.color[0]) {\n      this.addVaryCode('varying vec4 vColor;');\n      this.addVertexParsCode('attribute vec4 color;');\n      this.addVertexFinalCode('vColor = color;');\n    }\n\n    if (this.requires.color[1]) {\n      this.addVaryCode('varying vec4 vColor2;');\n      this.addVertexParsCode('attribute vec4 color2;');\n      this.addVertexFinalCode('vColor2 = color2;');\n    }\n\n    if (this.requires.position) {\n      this.addVaryCode('varying vec3 vPosition;');\n      this.addVertexFinalCode('vPosition = transformed;');\n    }\n\n    if (this.requires.worldPosition) {\n      this.addVaryCode('varying vec3 vWPosition;');\n      this.addVertexFinalCode('vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;');\n    }\n\n    if (this.requires.normal) {\n      this.addVaryCode('varying vec3 vObjectNormal;');\n      this.addVertexFinalCode('vObjectNormal = normal;');\n    }\n\n    if (this.requires.worldNormal) {\n      this.addVaryCode('varying vec3 vWNormal;');\n      this.addVertexFinalCode('vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;');\n    }\n\n    return this;\n  },\n  buildShader: function (shader, node) {\n    this.resultCode[shader] = node.build(this.setShader(shader), 'v4');\n  },\n  setMaterial: function (material, renderer) {\n    this.material = material;\n    this.renderer = renderer;\n    this.requires.lights = material.lights;\n    this.requires.fog = material.fog;\n    this.mergeDefines(material.defines);\n    return this;\n  },\n  addFlow: function (slot, cache, context) {\n    return this.addSlot(slot).addCache(cache).addContext(context);\n  },\n  removeFlow: function () {\n    return this.removeSlot().removeCache().removeContext();\n  },\n  addCache: function (name) {\n    this.cache = name || '';\n    this.caches.push(this.cache);\n    return this;\n  },\n  removeCache: function () {\n    this.caches.pop();\n    this.cache = this.caches[this.caches.length - 1] || '';\n    return this;\n  },\n  addContext: function (context) {\n    this.context = Object.assign({}, this.context, context);\n    this.context.extra = this.context.extra || {};\n    this.contexts.push(this.context);\n    return this;\n  },\n  removeContext: function () {\n    this.contexts.pop();\n    this.context = this.contexts[this.contexts.length - 1] || {};\n    return this;\n  },\n  addSlot: function (name) {\n    this.slot = name || '';\n    this.slots.push(this.slot);\n    return this;\n  },\n  removeSlot: function () {\n    this.slots.pop();\n    this.slot = this.slots[this.slots.length - 1] || '';\n    return this;\n  },\n  addVertexCode: function (code) {\n    this.addCode(code, 'vertex');\n  },\n  addFragmentCode: function (code) {\n    this.addCode(code, 'fragment');\n  },\n  addCode: function (code, shader) {\n    this.code[shader || this.shader] += code + '\\n';\n  },\n  addVertexNodeCode: function (code) {\n    this.addNodeCode(code, 'vertex');\n  },\n  addFragmentNodeCode: function (code) {\n    this.addNodeCode(code, 'fragment');\n  },\n  addNodeCode: function (code, shader) {\n    this.nodeCode[shader || this.shader] += code + '\\n';\n  },\n  clearNodeCode: function (shader) {\n    shader = shader || this.shader;\n    var code = this.nodeCode[shader];\n    this.nodeCode[shader] = '';\n    return code;\n  },\n  clearVertexNodeCode: function () {\n    return this.clearNodeCode('vertex');\n  },\n  clearFragmentNodeCode: function () {\n    return this.clearNodeCode('fragment');\n  },\n  addVertexFinalCode: function (code) {\n    this.addFinalCode(code, 'vertex');\n  },\n  addFragmentFinalCode: function (code) {\n    this.addFinalCode(code, 'fragment');\n  },\n  addFinalCode: function (code, shader) {\n    this.finalCode[shader || this.shader] += code + '\\n';\n  },\n  addVertexParsCode: function (code) {\n    this.addParsCode(code, 'vertex');\n  },\n  addFragmentParsCode: function (code) {\n    this.addParsCode(code, 'fragment');\n  },\n  addParsCode: function (code, shader) {\n    this.parsCode[shader || this.shader] += code + '\\n';\n  },\n  addVaryCode: function (code) {\n    this.addVertexParsCode(code);\n    this.addFragmentParsCode(code);\n  },\n  isCache: function (name) {\n    return this.caches.indexOf(name) !== -1;\n  },\n  isSlot: function (name) {\n    return this.slots.indexOf(name) !== -1;\n  },\n  define: function (name, value) {\n    this.defines[name] = value === undefined ? 1 : value;\n  },\n  require: function (name) {\n    this.requires[name] = true;\n  },\n  isDefined: function (name) {\n    return this.defines[name] !== undefined;\n  },\n  getVar: function (uuid, type, ns, shader = 'varying', prefix = 'V', label = '') {\n    var vars = this.getVars(shader),\n        data = vars[uuid];\n\n    if (!data) {\n      var index = vars.length,\n          name = ns ? ns : 'node' + prefix + index + (label ? '_' + label : '');\n      data = {\n        name: name,\n        type: type\n      };\n      vars.push(data);\n      vars[uuid] = data;\n    }\n\n    return data;\n  },\n  getTempVar: function (uuid, type, ns, label) {\n    return this.getVar(uuid, type, ns, this.shader, 'T', label);\n  },\n  getAttribute: function (name, type) {\n    if (!this.attributes[name]) {\n      var varying = this.getVar(name, type);\n      this.addVertexParsCode('attribute ' + type + ' ' + name + ';');\n      this.addVertexFinalCode(varying.name + ' = ' + name + ';');\n      this.attributes[name] = {\n        varying: varying,\n        name: name,\n        type: type\n      };\n    }\n\n    return this.attributes[name];\n  },\n  getCode: function (shader) {\n    return [this.prefixCode, this.parsCode[shader], this.getVarListCode(this.getVars('varying'), 'varying'), this.getVarListCode(this.inputs.uniforms[shader], 'uniform'), this.getIncludesCode('consts', shader), this.getIncludesCode('structs', shader), this.getIncludesCode('functions', shader), 'void main() {', this.getVarListCode(this.getVars(shader)), this.code[shader], this.resultCode[shader], this.finalCode[shader], '}'].join('\\n');\n  },\n  getVarListCode: function (vars, prefix) {\n    prefix = prefix || '';\n    var code = '';\n\n    for (let i = 0, l = vars.length; i < l; ++i) {\n      var nVar = vars[i],\n          type = nVar.type,\n          name = nVar.name;\n      var formatType = this.getFormatByType(type);\n\n      if (formatType === undefined) {\n        throw new Error('Node pars ' + formatType + ' not found.');\n      }\n\n      code += prefix + ' ' + formatType + ' ' + name + ';\\n';\n    }\n\n    return code;\n  },\n  getVars: function (shader) {\n    return this.inputs.vars[shader || this.shader];\n  },\n  getNodeData: function (node) {\n    var uuid = node.isNode ? node.uuid : node;\n    return this.nodeData[uuid] = this.nodeData[uuid] || {};\n  },\n  createUniform: function (shader, type, node, ns, needsUpdate, label) {\n    var uniforms = this.inputs.uniforms,\n        index = uniforms.list.length;\n    var uniform = new NodeUniform({\n      type: type,\n      name: ns ? ns : 'nodeU' + index + (label ? '_' + label : ''),\n      node: node,\n      needsUpdate: needsUpdate\n    });\n    uniforms.list.push(uniform);\n    uniforms[shader].push(uniform);\n    uniforms[shader][uniform.name] = uniform;\n    this.uniforms[uniform.name] = uniform;\n    return uniform;\n  },\n  createVertexUniform: function (type, node, ns, needsUpdate, label) {\n    return this.createUniform('vertex', type, node, ns, needsUpdate, label);\n  },\n  createFragmentUniform: function (type, node, ns, needsUpdate, label) {\n    return this.createUniform('fragment', type, node, ns, needsUpdate, label);\n  },\n  include: function (node, parent, source) {\n    var includesStruct;\n    node = typeof node === 'string' ? NodeLib.get(node) : node;\n\n    if (this.context.include === false) {\n      return node.name;\n    }\n\n    if (node instanceof FunctionNode) {\n      includesStruct = this.includes.functions;\n    } else if (node instanceof ConstNode) {\n      includesStruct = this.includes.consts;\n    } else if (node instanceof StructNode) {\n      includesStruct = this.includes.structs;\n    }\n\n    var includes = includesStruct[this.shader] = includesStruct[this.shader] || [];\n\n    if (node) {\n      var included = includes[node.name];\n\n      if (!included) {\n        included = includes[node.name] = {\n          node: node,\n          deps: []\n        };\n        includes.push(included);\n        included.src = node.build(this, 'source');\n      }\n\n      if (node instanceof FunctionNode && parent && includes[parent.name] && includes[parent.name].deps.indexOf(node) == -1) {\n        includes[parent.name].deps.push(node);\n\n        if (node.includes && node.includes.length) {\n          var i = 0;\n\n          do {\n            this.include(node.includes[i++], parent);\n          } while (i < node.includes.length);\n        }\n      }\n\n      if (source) {\n        included.src = source;\n      }\n\n      return node.name;\n    } else {\n      throw new Error('Include not found.');\n    }\n  },\n  colorToVectorProperties: function (color) {\n    return color.replace('r', 'x').replace('g', 'y').replace('b', 'z').replace('a', 'w');\n  },\n  colorToVector: function (color) {\n    return color.replace(/c/g, 'v3');\n  },\n  getIncludes: function (type, shader) {\n    return this.includes[type][shader || this.shader];\n  },\n  getIncludesCode: function () {\n    function sortByPosition(a, b) {\n      return a.deps.length - b.deps.length;\n    }\n\n    return function getIncludesCode(type, shader) {\n      var includes = this.getIncludes(type, shader);\n      if (!includes) return '';\n      var code = '',\n          includes = includes.sort(sortByPosition);\n\n      for (let i = 0; i < includes.length; i++) {\n        if (includes[i].src) code += includes[i].src + '\\n';\n      }\n\n      return code;\n    };\n  }(),\n  getConstructorFromLength: function (len) {\n    return constructors[len - 1];\n  },\n  isTypeMatrix: function (format) {\n    return /^m/.test(format);\n  },\n  getTypeLength: function (type) {\n    if (type === 'f') return 1;\n    return parseInt(this.colorToVector(type).substr(1));\n  },\n  getTypeFromLength: function (len) {\n    if (len === 1) return 'f';\n    return 'v' + len;\n  },\n  findNode: function () {\n    for (let i = 0; i < arguments.length; i++) {\n      var nodeCandidate = arguments[i];\n\n      if (nodeCandidate !== undefined && nodeCandidate.isNode) {\n        return nodeCandidate;\n      }\n    }\n  },\n  resolve: function () {\n    for (let i = 0; i < arguments.length; i++) {\n      var nodeCandidate = arguments[i];\n\n      if (nodeCandidate !== undefined) {\n        if (nodeCandidate.isNode) {\n          return nodeCandidate;\n        } else if (nodeCandidate.isTexture) {\n          switch (nodeCandidate.mapping) {\n            case CubeReflectionMapping:\n            case CubeRefractionMapping:\n              return new CubeTextureNode(nodeCandidate);\n\n            case CubeUVReflectionMapping:\n            case CubeUVRefractionMapping:\n              return new TextureCubeNode(new TextureNode(nodeCandidate));\n\n            default:\n              return new TextureNode(nodeCandidate);\n          }\n        } else if (nodeCandidate.isVector2) {\n          return new Vector2Node(nodeCandidate);\n        } else if (nodeCandidate.isVector3) {\n          return new Vector3Node(nodeCandidate);\n        } else if (nodeCandidate.isVector4) {\n          return new Vector4Node(nodeCandidate);\n        }\n      }\n    }\n  },\n  format: function (code, from, to) {\n    var typeToType = this.colorToVector(to + ' <- ' + from);\n\n    switch (typeToType) {\n      case 'f <- v2':\n        return code + '.x';\n\n      case 'f <- v3':\n        return code + '.x';\n\n      case 'f <- v4':\n        return code + '.x';\n\n      case 'f <- i':\n      case 'f <- b':\n        return 'float( ' + code + ' )';\n\n      case 'v2 <- f':\n        return 'vec2( ' + code + ' )';\n\n      case 'v2 <- v3':\n        return code + '.xy';\n\n      case 'v2 <- v4':\n        return code + '.xy';\n\n      case 'v2 <- i':\n      case 'v2 <- b':\n        return 'vec2( float( ' + code + ' ) )';\n\n      case 'v3 <- f':\n        return 'vec3( ' + code + ' )';\n\n      case 'v3 <- v2':\n        return 'vec3( ' + code + ', 0.0 )';\n\n      case 'v3 <- v4':\n        return code + '.xyz';\n\n      case 'v3 <- i':\n      case 'v3 <- b':\n        return 'vec2( float( ' + code + ' ) )';\n\n      case 'v4 <- f':\n        return 'vec4( ' + code + ' )';\n\n      case 'v4 <- v2':\n        return 'vec4( ' + code + ', 0.0, 1.0 )';\n\n      case 'v4 <- v3':\n        return 'vec4( ' + code + ', 1.0 )';\n\n      case 'v4 <- i':\n      case 'v4 <- b':\n        return 'vec4( float( ' + code + ' ) )';\n\n      case 'i <- f':\n      case 'i <- b':\n        return 'int( ' + code + ' )';\n\n      case 'i <- v2':\n        return 'int( ' + code + '.x )';\n\n      case 'i <- v3':\n        return 'int( ' + code + '.x )';\n\n      case 'i <- v4':\n        return 'int( ' + code + '.x )';\n\n      case 'b <- f':\n        return '( ' + code + ' != 0.0 )';\n\n      case 'b <- v2':\n        return '( ' + code + ' != vec2( 0.0 ) )';\n\n      case 'b <- v3':\n        return '( ' + code + ' != vec3( 0.0 ) )';\n\n      case 'b <- v4':\n        return '( ' + code + ' != vec4( 0.0 ) )';\n\n      case 'b <- i':\n        return '( ' + code + ' != 0 )';\n    }\n\n    return code;\n  },\n  getTypeByFormat: function (format) {\n    return convertFormatToType[format] || format;\n  },\n  getFormatByType: function (type) {\n    return convertTypeToFormat[type] || type;\n  },\n  getUuid: function (uuid, useCache) {\n    useCache = useCache !== undefined ? useCache : true;\n    if (useCache && this.cache) uuid = this.cache + '-' + uuid;\n    return uuid;\n  },\n  getElementByIndex: function (index) {\n    return elements[index];\n  },\n  getIndexByElement: function (elm) {\n    return elements.indexOf(elm);\n  },\n  isShader: function (shader) {\n    return this.shader === shader;\n  },\n  setShader: function (shader) {\n    this.shader = shader;\n    return this;\n  },\n  mergeDefines: function (defines) {\n    for (let name in defines) {\n      this.defines[name] = defines[name];\n    }\n\n    return this.defines;\n  },\n  mergeUniform: function (uniforms) {\n    for (let name in uniforms) {\n      this.uniforms[name] = uniforms[name];\n    }\n\n    return this.uniforms;\n  },\n  getTextureEncodingFromMap: function (map) {\n    var encoding;\n\n    if (!map) {\n      encoding = LinearEncoding;\n    } else if (map.isTexture) {\n      encoding = map.encoding;\n    } else if (map.isWebGLRenderTarget) {\n      console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\");\n      encoding = map.texture.encoding;\n    }\n\n    if (encoding === LinearEncoding && this.context.gamma) {\n      encoding = GammaEncoding;\n    }\n\n    return encoding;\n  }\n};\n\nexport { NodeBuilder };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import { WebGLRenderTarget, OrthographicCamera, Scene, Mesh, PlaneGeometry } from 'three';\nimport { NodeBuilder } from '../core/NodeBuilder.js';\nimport { NodeMaterial } from '../materials/NodeMaterial.js';\nimport { TextureNode } from './TextureNode.js';\n\nfunction RTTNode(width, height, input, options) {\n  options = options || {};\n  this.input = input;\n  this.clear = options.clear !== undefined ? options.clear : true;\n  this.renderTarget = new WebGLRenderTarget(width, height, options);\n  this.material = new NodeMaterial();\n  this.camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1);\n  this.scene = new Scene();\n  this.quad = new Mesh(new PlaneGeometry(2, 2), this.material);\n  this.quad.frustumCulled = false; // Avoid getting clipped\n\n  this.scene.add(this.quad);\n  this.render = true;\n  TextureNode.call(this, this.renderTarget.texture);\n}\n\nRTTNode.prototype = Object.create(TextureNode.prototype);\nRTTNode.prototype.constructor = RTTNode;\nRTTNode.prototype.nodeType = 'RTT';\n\nRTTNode.prototype.build = function (builder, output, uuid) {\n  var rttBuilder = new NodeBuilder();\n  rttBuilder.nodes = builder.nodes;\n  rttBuilder.updaters = builder.updaters;\n  this.material.fragment.value = this.input;\n  this.material.build({\n    builder: rttBuilder\n  });\n  return TextureNode.prototype.build.call(this, builder, output, uuid);\n};\n\nRTTNode.prototype.updateFramesaveTo = function (frame) {\n  this.saveTo.render = false;\n\n  if (this.saveTo !== this.saveToCurrent) {\n    if (this.saveToMaterial) this.saveToMaterial.dispose();\n    var material = new NodeMaterial();\n    material.fragment.value = this;\n    material.build();\n    var scene = new Scene();\n    var quad = new Mesh(new PlaneGeometry(2, 2), material);\n    quad.frustumCulled = false; // Avoid getting clipped\n\n    scene.add(quad);\n    this.saveToScene = scene;\n    this.saveToMaterial = material;\n  }\n\n  this.saveToCurrent = this.saveTo;\n  frame.renderer.setRenderTarget(this.saveTo.renderTarget);\n  if (this.saveTo.clear) frame.renderer.clear();\n  frame.renderer.render(this.saveToScene, this.camera);\n};\n\nRTTNode.prototype.updateFrame = function (frame) {\n  if (frame.renderer) {\n    // from the second frame\n    if (this.saveTo && this.saveTo.render === false) {\n      this.updateFramesaveTo(frame);\n    }\n\n    if (this.render) {\n      if (this.material.uniforms.renderTexture) {\n        this.material.uniforms.renderTexture.value = frame.renderTexture;\n      }\n\n      frame.renderer.setRenderTarget(this.renderTarget);\n      if (this.clear) frame.renderer.clear();\n      frame.renderer.render(this.scene, this.camera);\n    } // first frame\n\n\n    if (this.saveTo && this.saveTo.render === true) {\n      this.updateFramesaveTo(frame);\n    }\n  } else {\n    console.warn('RTTNode need a renderer in NodeFrame');\n  }\n};\n\nRTTNode.prototype.copy = function (source) {\n  TextureNode.prototype.copy.call(this, source);\n  this.saveTo = source.saveTo;\n  return this;\n};\n\nRTTNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = TextureNode.prototype.toJSON.call(this, meta);\n    if (this.saveTo) data.saveTo = this.saveTo.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n\nexport { RTTNode };","map":{"version":3,"names":["WebGLRenderTarget","OrthographicCamera","Scene","Mesh","PlaneGeometry","NodeBuilder","NodeMaterial","TextureNode","RTTNode","width","height","input","options","clear","undefined","renderTarget","material","camera","scene","quad","frustumCulled","add","render","call","texture","prototype","Object","create","constructor","nodeType","build","builder","output","uuid","rttBuilder","nodes","updaters","fragment","value","updateFramesaveTo","frame","saveTo","saveToCurrent","saveToMaterial","dispose","saveToScene","renderer","setRenderTarget","updateFrame","uniforms","renderTexture","console","warn","copy","source","toJSON","meta","data","getJSONNode"],"sources":["/Users/98yaroslavgorban/Desktop/gltfjsx-forked/node_modules/three-stdlib/nodes/inputs/RTTNode.js"],"sourcesContent":["import { WebGLRenderTarget, OrthographicCamera, Scene, Mesh, PlaneGeometry } from 'three';\nimport { NodeBuilder } from '../core/NodeBuilder.js';\nimport { NodeMaterial } from '../materials/NodeMaterial.js';\nimport { TextureNode } from './TextureNode.js';\n\nfunction RTTNode(width, height, input, options) {\n  options = options || {};\n  this.input = input;\n  this.clear = options.clear !== undefined ? options.clear : true;\n  this.renderTarget = new WebGLRenderTarget(width, height, options);\n  this.material = new NodeMaterial();\n  this.camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1);\n  this.scene = new Scene();\n  this.quad = new Mesh(new PlaneGeometry(2, 2), this.material);\n  this.quad.frustumCulled = false; // Avoid getting clipped\n\n  this.scene.add(this.quad);\n  this.render = true;\n  TextureNode.call(this, this.renderTarget.texture);\n}\n\nRTTNode.prototype = Object.create(TextureNode.prototype);\nRTTNode.prototype.constructor = RTTNode;\nRTTNode.prototype.nodeType = 'RTT';\n\nRTTNode.prototype.build = function (builder, output, uuid) {\n  var rttBuilder = new NodeBuilder();\n  rttBuilder.nodes = builder.nodes;\n  rttBuilder.updaters = builder.updaters;\n  this.material.fragment.value = this.input;\n  this.material.build({\n    builder: rttBuilder\n  });\n  return TextureNode.prototype.build.call(this, builder, output, uuid);\n};\n\nRTTNode.prototype.updateFramesaveTo = function (frame) {\n  this.saveTo.render = false;\n\n  if (this.saveTo !== this.saveToCurrent) {\n    if (this.saveToMaterial) this.saveToMaterial.dispose();\n    var material = new NodeMaterial();\n    material.fragment.value = this;\n    material.build();\n    var scene = new Scene();\n    var quad = new Mesh(new PlaneGeometry(2, 2), material);\n    quad.frustumCulled = false; // Avoid getting clipped\n\n    scene.add(quad);\n    this.saveToScene = scene;\n    this.saveToMaterial = material;\n  }\n\n  this.saveToCurrent = this.saveTo;\n  frame.renderer.setRenderTarget(this.saveTo.renderTarget);\n  if (this.saveTo.clear) frame.renderer.clear();\n  frame.renderer.render(this.saveToScene, this.camera);\n};\n\nRTTNode.prototype.updateFrame = function (frame) {\n  if (frame.renderer) {\n    // from the second frame\n    if (this.saveTo && this.saveTo.render === false) {\n      this.updateFramesaveTo(frame);\n    }\n\n    if (this.render) {\n      if (this.material.uniforms.renderTexture) {\n        this.material.uniforms.renderTexture.value = frame.renderTexture;\n      }\n\n      frame.renderer.setRenderTarget(this.renderTarget);\n      if (this.clear) frame.renderer.clear();\n      frame.renderer.render(this.scene, this.camera);\n    } // first frame\n\n\n    if (this.saveTo && this.saveTo.render === true) {\n      this.updateFramesaveTo(frame);\n    }\n  } else {\n    console.warn('RTTNode need a renderer in NodeFrame');\n  }\n};\n\nRTTNode.prototype.copy = function (source) {\n  TextureNode.prototype.copy.call(this, source);\n  this.saveTo = source.saveTo;\n  return this;\n};\n\nRTTNode.prototype.toJSON = function (meta) {\n  var data = this.getJSONNode(meta);\n\n  if (!data) {\n    data = TextureNode.prototype.toJSON.call(this, meta);\n    if (this.saveTo) data.saveTo = this.saveTo.toJSON(meta).uuid;\n  }\n\n  return data;\n};\n\nexport { RTTNode };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}